<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ansible YAML Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 text-gray-900 min-h-screen flex items-center justify-center">
    <div class="max-w-4xl w-full p-6 bg-white rounded-xl shadow-md">
      <h1 class="text-2xl font-bold mb-6 text-center">Ansible YAML Generator</h1>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label for="os" class="font-semibold">Select OS:</label>
          <select id="os" class="w-full mt-1 p-2 border rounded">
            <option value="ubuntu">Ubuntu</option>
            <option value="redhat">RedHat</option>
            <option value="amazon">Amazon Linux</option>
            <option value="alpine">Alpine</option>
          </select>
        </div>

        <div>
          <label for="app" class="font-semibold">Select Application:</label>
          <select id="app" class="w-full mt-1 p-2 border rounded">
            <option value="nginx">Nginx</option>
            <option value="httpd">HTTPD</option>
            <option value="apache2">Apache2</option>
            <option value="mysql">MySQL</option>
            <option value="mariadb">MariaDB</option>
            <option value="maven">Maven</option>
            <option value="openjdk11">OpenJDK 11</option>
            <option value="openjdk17">OpenJDK 17</option>
            <option value="openjdk21">OpenJDK 21</option>
            <option value="mongodb">MongoDB</option>
            <option value="nodejs">Node.js</option>
          </select>
        </div>
      </div>

      <div class="mt-4">
        <p class="font-semibold mb-1">Actions:</p>
        <label class="inline-flex items-center mr-4">
          <input type="checkbox" value="install" class="action mr-2"> Install
        </label>
        <label class="inline-flex items-center">
          <input type="checkbox" value="remove" class="action mr-2"> Remove
        </label>
      </div>

      <div class="mt-4">
        <p class="font-semibold mb-1">Optional Features:</p>
        <label class="inline-flex items-center mr-4">
          <input type="checkbox" value="config" class="feature mr-2"> Config
        </label>
        <label class="inline-flex items-center mr-4">
          <input type="checkbox" value="ssl" class="feature mr-2"> SSL
        </label>
        <label class="inline-flex items-center">
          <input type="checkbox" value="firewall" class="feature mr-2"> Firewall
        </label>
      </div>

      <div class="mt-6 flex gap-4">
        <button onclick="generateYAML()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Generate YAML</button>
        <button onclick="downloadYAML()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Download YAML</button>
      </div>

      <div class="mt-6">
        <label class="font-semibold">Generated YAML:</label>
        <pre id="output" class="bg-gray-200 p-4 rounded whitespace-pre-wrap mt-2"></pre>
      </div>
    </div>

    <script>
      function generateYAML() {
        const os = document.getElementById("os").value;
        const app = document.getElementById("app").value;
        const actions = [...document.querySelectorAll(".action:checked")].map(el => el.value);
        const features = [...document.querySelectorAll(".feature:checked")].map(el => el.value);

        let yaml = `- name: Manage ${app} on ${os}\n  hosts: all\n  become: true\n  tasks:\n`;

        if (actions.includes("install")) {
          yaml += getInstallTask(os, app);
        }

        if (actions.includes("remove")) {
          yaml += getRemoveTask(os, app);
        }

        features.forEach(feature => {
          yaml += getFeatureTask(app, feature);
        });

        document.getElementById("output").textContent = yaml;
      }

      function getInstallTask(os, app) {
        if (["ubuntu", "amazon", "alpine"].includes(os)) {
          return `  - name: Install ${app}\n    apt:\n      name: ${app}\n      state: present\n\n`;
        } else if (os === "redhat") {
          return `  - name: Install ${app}\n    yum:\n      name: ${app}\n      state: present\n\n`;
        }
        return "";
      }

      function getRemoveTask(os, app) {
        if (["ubuntu", "amazon", "alpine"].includes(os)) {
          return `  - name: Remove ${app}\n    apt:\n      name: ${app}\n      state: absent\n      purge: yes\n\n`;
        } else if (os === "redhat") {
          return `  - name: Remove ${app}\n    yum:\n      name: ${app}\n      state: absent\n\n`;
        }
        return "";
      }

      function getFeatureTask(app, feature) {
        if (feature === "config") {
          return `  - name: Configure ${app}\n    template:\n      src: templates/${app}.j2\n      dest: /etc/${app}/${app}.conf\n\n`;
        }
        if (feature === "firewall") {
          return `  - name: Allow HTTP traffic\n    ufw:\n      rule: allow\n      port: 80\n\n`;
        }
        if (feature === "ssl") {
          return `  - name: Setup SSL for ${app}\n    copy:\n      src: files/ssl-cert.crt\n      dest: /etc/ssl/certs/${app}.crt\n\n`;
        }
        return "";
      }

      function downloadYAML() {
        const yaml = document.getElementById("output").textContent;
        const blob = new Blob([yaml], { type: "text/yaml" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "playbook.yml";
        a.click();
      }
    </script>
  </body>
</html>